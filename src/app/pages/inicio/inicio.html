<div class="dashboard">

  <mat-card class="filter-bar">
    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>Filtrar por Tienda</mat-label>
      <mat-select
        [value]="tiendaSeleccionada()"
        (selectionChange)="onTiendaChange($event.value)"
        [disabled]="isLoading()"
      >
        <mat-option [value]="null">Todas las tiendas</mat-option>
        @for (tienda of tiendas(); track tienda.id) {
        <mat-option [value]="tienda.id">{{ tienda.nombre }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>Filtrar por Estado</mat-label>
      <mat-select
        multiple
        [value]="estadosSeleccionados()"
        (selectionChange)="onEstadoChange($event.value)"
        [disabled]="isLoading()"
      >
        @for (estado of estados(); track estado) {
        <mat-option [value]="estado">{{ estado }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>Filtrar por tipo</mat-label>
      <mat-select
        multiple
        [value]="tiposSeleccionados()"
        (selectionChange)="onTipoChange($event.value)"
        [disabled]="isLoading()"
      >
        @for (tipo of tipos(); track tipo) {
        <mat-option [value]="tipo">{{ tipo }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <div class="filter-actions">
      <button mat-stroked-button type="button" (click)="limpiarFiltros()" [disabled]="isLoading()">
        Limpiar filtros
      </button>
    </div>
  </mat-card>

  @if (isLoading()) {
  <p class="loading-state">Actualizando dashboard...</p>
  }

  <div class="kpis">
    <mat-card class="kpi">
      <h4>Actas (Filtradas)</h4>
      <strong>{{ totalActas() }}</strong>
    </mat-card>
    <mat-card class="kpi">
      <h4>Activos</h4>
      <strong>{{ totalActivos() }}</strong>
    </mat-card>
    <mat-card class="kpi">
      <h4>Disponibles</h4>
      <strong>{{ disponibles() }}</strong>
    </mat-card>
    <mat-card class="kpi">
      <h4>Responsables</h4>
      <strong>{{ responsables() }}</strong>
    </mat-card>
  </div>

  <div class="charts">
    <mat-card>
      <h3>Actas por mes</h3>
      <canvas baseChart [data]="lineChartData" [type]="lineChartType" [options]="lineChartOptions">
      </canvas>
    </mat-card>

    <mat-card>
      <h3>Activos por tipo</h3>
      <canvas baseChart [data]="pieChartData" [type]="pieChartType" [options]="pieChartOptions">
      </canvas>
    </mat-card>

    <mat-card>
      <h3>Estado de activos</h3>
      <canvas baseChart [data]="barChartData" [type]="barChartType" [options]="barChartOptions">
      </canvas>
    </mat-card>
  </div>
</div>
