<div class="container">
    <h2>Historial de Movimientos</h2>

    <table class="tabla">
        <thead>
            <tr>
                <th>ID</th>
                <th>Fecha</th>
                <th>Tienda</th>
                <th>Responsable</th>
                <th>Estado Asignación</th>
                <th>Caso</th>
                <th>Ubicación</th>
                <th>Actas</th>
            </tr>
        </thead>

        <tbody>
            @for (mov of movimientosPaginados(); track mov.id) {

            <!-- FILA PRINCIPAL -->
            <tr class="fila-movimiento" (click)="toggle(mov.id)">
                <td>{{ mov.id }}</td>
                <td>{{ mov.asignacion.created_at | date:'dd/MM/yyyy' }}</td>
                <td>{{ mov.tienda?.nombre }}</td>
                <td>{{ mov.users.name }}</td>
                <td>
                    <span class="status" [ngClass]="mov.estadoAsignacion?.toLowerCase()">
                        {{ mov.estadoAsignacion }}
                    </span>
                </td>

                <td>{{ mov.caso }}</td>
                <td>{{ mov.ubicacionElemento }}</td>

                <td>
                    @if (mov.acta && mov.acta !== 'N/A' && mov.acta !== 'pendiente') {
                    <button class="btn-pdf" (click)="verActa(mov.acta, $event)">
                        <span class="material-icons">picture_as_pdf</span>
                    </button>
                    } @else {
                    <span class="no-acta">Sin acta</span>
                    }
                </td>


            </tr>

            <!-- FILA EXPANDIDA -->
            @if (expandedId === mov.id) {
            <tr class="detalle-row">
                <td colspan="9">

                    <table class="subtabla">
                        <thead>
                            <tr>
                                <th>Serial</th>
                                <th>Tipo</th>
                                <th>Fabricante</th>
                                <th>Modelo</th>
                                <th>Estado</th>
                            </tr>
                        </thead>

                        <tbody>
                            @for (el of mov.elemento; track $index) {
                            <tr>
                                <td>{{ el.serial }}</td>
                                <td>{{ el.elemento?.tipo }}</td>
                                <td>{{ el.elemento?.fabricante }}</td>
                                <td>{{ el.elemento?.modelo }}</td>
                                <td>{{ el.estadoElemento }}</td>
                            </tr>
                            }
                        </tbody>
                    </table>

                </td>
            </tr>
            }

            }
        </tbody>
    </table>


    <div class="paginacion">
        <span class="page-info">Página {{ paginaActual() }} de {{ totalPaginas() }}</span>

        <button class="pagi-btn" [disabled]="paginaActual() === 1" (click)="cambiarPagina(paginaActual() - 1)">
            <span class="material-icons">chevron_left</span>
        </button>

        <button class="pagi-btn" [disabled]="paginaActual() === totalPaginas()"
            (click)="cambiarPagina(paginaActual() + 1)">
            <span class="material-icons">chevron_right</span>
        </button>
    </div>
</div>
